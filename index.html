<!DOCTYPE html>
<html>
<head>
	<title> Chat System</title>
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<script src="/js/jquery.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/html/socket.io.js"></script>
	<style type="text/css">
		body 
		{
			margin-top: 30px; 
		}
		ul
		{
			list-style-type: none;
		}
	</style>

</head>
<body>
	<div class = "container">
		<div class = "row">
			<div class= "col-md-4">
				<div class="well">
					<h3> chats </h3>
					<ul class = "list-grouop" id="chats"></ul> 



				</div>
			</div>
			<div class= "col-md-8">
				<div class = "chat" id="chat"></div>

				<form id="messageForm">
					<div class="form-group">
						<label> Enter Message</label>
						<textarea class="form-control" id="message"></textarea> <br/>
						<input type="submit" class ="btn btn-primary" value="Send Message">
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>

		const url = 'http://localhost:8888/chats';
		const ul = document.getElementById('chats');
		const ul_chat_details= document.getElementById('chat_details');

		fetch(url, { credentials: 'include' })
		  .then(response => response.json())
		  .then(json => { console.log(json) })

		// Create the type of element you pass in the parameters
	    function createNode(element) 
	    {
			return document.createElement(element); 
		}

		// Append the second parameter(element) to the first one
		function append(parent, el) 
		{
			return parent.appendChild(el); 
		}

		fetch(url, { credentials: 'include' })
		.then((resp) => resp.json()) 
		.then(function(data) 
		{
		      // Create and append the li's to the ul
		      let chats = data.chats;
		   	  return data.chats.map(function(chat) 
		   	  { // Map through the results and for each run the code below
			      let li_the_chat = createNode('li'); //  Create the elements we need
			      let li_last_message = createNode('li'); //  Create the elements we need
			      let li_time = createNode('li'); //  Create the elements we need
			      let br_chat = createNode('br'); //  Create the elements we need


			      span_chat = createNode('span');
			      span_chat.innerHTML = `${chat.buddy}`; // Make the HTML of our span to be the first person in the chat

			      span_last_message = createNode('span');
			      span_last_message.innerHTML = `${chat.lastMessage}`; // Make the HTML of our span to be the first person in the chat

			      span_time = createNode('span');
			      span_time.innerHTML = `${chat.timestamp}`; // Make the HTML of our span to be the first person in the chat


			      append(li_the_chat, span_chat);

			      append(ul, li_the_chat);

			      append(li_last_message, span_last_message);

			      append(ul, li_last_message);

			      append(li_time, span_time);

			      append(ul, li_time );

			      append(ul, br_chat );

			      
			     

			      

			  });
		});

	</script>

</body>
</html>

